{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}School Intelligence Platform{% endblock %}</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet" crossorigin="anonymous">

    <!-- Theme -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}?v=2">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>

<body>
<div class="app-shell">
    <!-- Sidebar -->
    <aside class="app-sidebar">
        <div class="app-logo">
            {% if current_school %}
                {{ current_school.name }}
                {% if current_school.tagline %}
                    <span>{{ current_school.tagline }}</span>
                {% else %}
                    <span>Performance &amp; Timetables</span>
                {% endif %}
            {% else %}
                School Intelligence
                <span>Performance &amp; Timetables</span>
            {% endif %}
        </div>

        {% if request.user.is_authenticated %}
        <div class="sidebar-section">
            <div class="sidebar-section-title">Navigation</div>
            <ul class="sidebar-nav">

                {# ================= MANAGEMENT ================= #}
                {% if request.user.role == request.user.Role.MANAGEMENT %}
                    <li>
                        <a href="{% url 'management_dashboard' %}"
                           class="{{ nav_management_active|default:'' }}">
                            Management Dashboard
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'timetable_class_list' %}"
                           class="{{ nav_timetable_active|default:'' }}">
                            Timetables
                        </a>
                    </li>

                    <li class="mt-3 sidebar-section-title">Finance</li>
                    <li>
                        <a href="{% url 'finance:overview' %}"
                           class="{{ nav_finance_active|default:'' }}">
                            Fee Overview
                        </a>
                    </li>


                    <li class="mt-3 sidebar-section-title">Communication</li>
                    <li>
                        <a href="{% url 'communication:my_announcements' %}"
                           class="{{ nav_announcements_active|default:'' }}">
                            Announcements
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'communication:calendar' %}"
                           class="{{ nav_calendar_active|default:'' }}">
                            Events &amp; Holidays
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'communication:all_concerns' %}"
                           class="{{ nav_concerns_admin_active|default:'' }}">
                            Parent Concerns
                        </a>
                    </li>

                {# ================= CLASS TEACHER ================= #}
                {% elif request.user.role == request.user.Role.CLASS_TEACHER %}
                    <li>
                        <a href="{% url 'class_teacher_dashboard' %}"
                           class="{{ nav_class_active|default:'' }}">
                            My Class
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'teacher_timetable_view' %}"
                           class="{{ nav_teacher_timetable_active|default:'' }}">
                            My Timetable
                        </a>
                    </li>

                    <li class="mt-3 sidebar-section-title">Communication</li>
                    <li>
                        <a href="{% url 'communication:my_announcements' %}"
                           class="{{ nav_announcements_active|default:'' }}">
                            Announcements
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'communication:calendar' %}"
                           class="{{ nav_calendar_active|default:'' }}">
                            Events &amp; Holidays
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'communication:all_concerns' %}"
                           class="{{ nav_concerns_admin_active|default:'' }}">
                            Parent Concerns
                        </a>
                    </li>

                {# ================= SUBJECT TEACHER (NON-CLASS) ================= #}
                {% elif request.user.role == request.user.Role.TEACHER %}
                    <li>
                        <a href="{% url 'teacher_timetable_view' %}"
                           class="{{ nav_teacher_timetable_active|default:'' }}">
                            My Timetable
                        </a>
                    </li>

                    <li class="mt-3 sidebar-section-title">Communication</li>
                    <li>
                        <a href="{% url 'communication:my_announcements' %}"
                           class="{{ nav_announcements_active|default:'' }}">
                            Announcements
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'communication:calendar' %}"
                           class="{{ nav_calendar_active|default:'' }}">
                            Events &amp; Holidays
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'communication:all_concerns' %}"
                           class="{{ nav_concerns_admin_active|default:'' }}">
                            Parent Concerns
                        </a>
                    </li>

                {# ================= STUDENT ================= #}
                {% elif request.user.role == request.user.Role.STUDENT %}
                    <li>
                        <a href="{% url 'student_dashboard' %}"
                           class="{{ nav_student_active|default:'' }}">
                            My Dashboard
                        </a>
                    </li>

                    <li class="mt-3 sidebar-section-title">My Fees</li>
                    <li>
                        <a href="{% url 'finance:my_fees' %}"
                           class="{{ nav_finance_active|default:'' }}">
                            Fee Details
                        </a>
                    </li>

                    <li class="mt-3 sidebar-section-title">Communication</li>
                    <li>
                        <a href="{% url 'communication:my_announcements' %}"
                           class="{{ nav_announcements_active|default:'' }}">
                            Announcements
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'communication:calendar' %}"
                           class="{{ nav_calendar_active|default:'' }}">
                            Events &amp; Holidays
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'communication:create_leave' %}"
                           class="{{ nav_leave_new_active|default:'' }}">
                            Apply for Leave
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'communication:my_leaves' %}"
                           class="{{ nav_leave_list_active|default:'' }}">
                            My Leave Requests
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'communication:create_concern' %}"
                           class="{{ nav_concern_new_active|default:'' }}">
                            Raise Concern
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'communication:my_concerns' %}"
                           class="{{ nav_concern_list_active|default:'' }}">
                            My Concerns
                        </a>
                    </li>
                {% endif %}

            </ul>
        </div>
        {% endif %}
    </aside>

    <!-- Main -->
    <div class="app-main">

        <!-- Topbar -->
        <header class="app-topbar">
            <div class="app-topbar-left">
                <div class="app-topbar-title">{% block page_title %}Dashboard{% endblock %}</div>
                <div class="app-badge">Beta</div>
            </div>

            <div class="app-topbar-right">
                {% if request.user.is_authenticated %}
                    <div class="topbar-user">
                        Logged in as <strong>{{ request.user.username }}</strong>
                        <span style="color:#9ca3af;"> â€¢ {{ request.user.role }}</span>
                    </div>

                    <form method="post" action="{% url 'logout' %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="topbar-link"
                                style="background:none;border:none;padding:0;color:#bfdbfe;cursor:pointer;">
                            Logout
                        </button>
                    </form>
                {% else %}
                    <a href="{% url 'login' %}" class="topbar-link">Login</a>
                {% endif %}
            </div>
        </header>

        <!-- Content -->
        <main class="app-content">
            {% block content %}{% endblock %}
        </main>
    </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{% block extra_js %}{% endblock %}

</body>
</html>
